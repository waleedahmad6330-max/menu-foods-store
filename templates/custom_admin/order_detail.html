{% extends 'store/base.html' %}

{% block content %}
<style>
    .admin-bg { background-color: #f8f9fa; min-height: 100vh; padding: 40px 0; }

    /* Card Styling */
    .detail-card {
        background: #fff;
        border-radius: 20px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.03);
        padding: 30px;
        border: 1px solid #eee;
        margin-bottom: 25px;
        position: relative;
        overflow: hidden;
    }

    /* Labels & Text */
    .section-label { font-size: 0.75rem; text-transform: uppercase; color: #999; font-weight: 700; letter-spacing: 1px; margin-bottom: 8px; display: block; }
    .data-value { font-size: 1rem; color: #333; font-weight: 600; }

    /* Input Fields */
    .clean-input {
        background-color: #fcfcfc; border: 1px solid #e0e0e0; border-radius: 10px; padding: 12px 15px; width: 100%; font-size: 0.95rem; color: #333; transition: 0.3s;
    }
    .clean-input:focus { background-color: #fff; border-color: #006837; outline: none; box-shadow: 0 0 0 3px rgba(0, 104, 55, 0.1); }

    /* Status Control Box */
    .status-card-wrapper {
        background: #fff; 
        padding: 30px; 
        border-radius: 20px; 
        box-shadow: 0 10px 40px rgba(0,0,0,0.06); 
        border-top: 6px solid #006837;
    }

    /* Custom Select */
    .custom-select { background-color: #f8f9fa; border: 2px solid #eee; border-radius: 10px; padding: 12px; font-weight: 600; color: #333; cursor: pointer; width: 100%; }
    
    /* Buttons */
    .btn-update { background-color: #006837; color: white; font-weight: 700; border: none; padding: 12px; border-radius: 50px; width: 100%; transition: 0.3s; margin-top: 15px; text-transform: uppercase; letter-spacing: 0.5px; }
    .btn-update:hover { background-color: #004d29; transform: translateY(-2px); color: white; }
    
    .btn-update-outline { background: transparent; border: 2px solid #333; color: #333; font-weight: 700; padding: 8px 20px; border-radius: 50px; font-size: 0.8rem; transition: 0.3s; width: 100%; }
    .btn-update-outline:hover { background: #333; color: white; }

    /* Items List */
    .item-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f9f9f9; }
    .item-row:last-child { border-bottom: none; }
    .product-thumb { width: 50px; height: 50px; object-fit: cover; border-radius: 8px; border: 1px solid #eee; }

    /* Desktop Sticky */
    @media (min-width: 992px) {
        .sticky-sidebar { position: sticky; top: 100px; }
    }

    /* Mobile */
    @media (max-width: 991px) {
        .admin-bg { padding: 20px 0; }
        .detail-card { padding: 20px; }
        .item-row { flex-wrap: wrap; }
        .item-info { width: 100%; margin-bottom: 10px; }
        .header-flex { flex-direction: column; align-items: flex-start; gap: 10px; }
    }
</style>

<div class="admin-bg">
    <div class="container">
        
        <div class="d-flex justify-content-between align-items-center mb-4 header-flex">
            <a href="{% url 'admin_all_orders' %}" class="text-decoration-none text-muted fw-bold small hover-link">
                <i class="fas fa-arrow-left me-2"></i> Back to Orders
            </a>
            <span class="badge bg-warning text-dark shadow-sm px-3 py-2 rounded-pill">Order #{{ order.id }}</span>
        </div>

        <div class="row g-4">
            
            <div class="col-12 col-lg-8">
                
                <div class="detail-card">
                    <div class="d-flex justify-content-between align-items-start mb-4">
                        <div>
                            <h3 class="fw-bold m-0 text-dark">Order Details</h3>
                            <p class="text-muted small mb-0">Placed on {{ order.created_at|date:"d M Y, h:i A" }}</p>
                        </div>
                        <div class="text-end">
                            <span class="section-label">Payment Method</span>
                            <div class="d-flex flex-column align-items-end gap-2">
                                <span class="badge bg-light text-dark border px-3 py-2">{{ order.payment_method|upper }}</span>
                                
                                {% if order.is_paid %}
                                    <span class="badge bg-success border px-3 py-2"><i class="fas fa-check-circle me-1"></i> PAID</span>
                                {% else %}
                                    <span class="badge bg-danger border px-3 py-2 mb-1"><i class="fas fa-times-circle me-1"></i> UNPAID</span>
                                    
                                    <form method="POST">
                                        {% csrf_token %}
                                        <input type="hidden" name="mark_paid" value="true">
                                        <button type="submit" class="btn btn-sm btn-outline-success rounded-pill fw-bold" onclick="return confirm('Confirm payment received?')">
                                            Mark as Paid
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <hr class="opacity-10 mb-4">
                    
                    <h6 class="fw-bold text-dark mb-3 d-flex align-items-center">
                        <div class="bg-light rounded-circle p-2 me-2"><i class="fas fa-shipping-fast text-success"></i></div>
                        Shipping Information
                    </h6>
                    
                    <form method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="update_address" value="true">
                        
                        <div class="row g-3">
                            <div class="col-md-6"><label class="section-label">Customer Name</label><input type="text" class="clean-input bg-light text-muted" value="{{ order.first_name }} {{ order.last_name }}" readonly></div>
                            <div class="col-md-6"><label class="section-label">Phone Number</label><input type="text" name="phone" value="{{ order.phone }}" class="clean-input" required></div>
                            <div class="col-12"><label class="section-label">Address</label><input type="text" name="address" value="{{ order.address }}" class="clean-input" required></div>
                            <div class="col-md-6"><label class="section-label">City</label><input type="text" name="city" value="{{ order.city }}" class="clean-input" required></div>
                            <div class="col-md-6 d-flex align-items-end"><button type="submit" class="btn-update-outline">Save Address Changes</button></div>
                        </div>
                    </form>
                </div>

                <div class="detail-card mb-4 mb-lg-0">
                    <h6 class="fw-bold border-bottom pb-3 mb-3 text-uppercase text-muted small">Items Ordered</h6>
                    
                    {% for item in order.items.all %}
                    <div class="item-row">
                        <div class="d-flex align-items-center item-info">
                            <div class="me-3">
                                {% if item.product.image %}<img src="{{ item.product.image.url }}" class="product-thumb">{% else %}<div class="product-thumb bg-light d-flex align-items-center justify-content-center"><i class="fas fa-image text-muted"></i></div>{% endif %}
                            </div>
                            <div>
                                <div class="fw-bold text-dark">{{ item.product.name }}</div>
                                <div class="small text-muted">Qty: {{ item.quantity }}</div>
                            </div>
                        </div>
                        <div class="fw-bold text-dark item-price">Rs. {{ item.price|floatformat:0 }}</div>
                    </div>
                    {% empty %}
                    <p class="text-center text-muted py-3">No items found.</p>
                    {% endfor %}
                    
                    <div class="border-top mt-3 pt-3 d-flex justify-content-between align-items-center bg-light p-3 rounded-3" style="border-left: 5px solid #006837;">
                        <span class="h6 fw-bold m-0 text-muted text-uppercase">Grand Total</span>
                        <span class="h3 fw-bold text-success m-0">Rs. {{ order.total_amount|floatformat:0 }}</span>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-4">
                <div class="sticky-sidebar">
                    <div class="status-card-wrapper">
                        <h5 class="fw-bold mb-4">Update Status</h5>
                        <form method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="update_status" value="true">
                            <div class="mb-4">
                                <label class="section-label">Current Status</label>
                                <select name="status" class="form-select custom-select">
                                    <option value="Pending" {% if order.status == 'Pending' %}selected{% endif %}>üü° Pending</option>
                                    <option value="Confirmed" {% if order.status == 'Confirmed' %}selected{% endif %}>üîµ Confirmed</option>
                                    <option value="Dispatch" {% if order.status == 'Dispatch' %}selected{% endif %}>üöö Dispatch</option>
                                    <option value="Delivered" {% if order.status == 'Delivered' %}selected{% endif %}>‚úÖ Delivered</option>
                                    <option value="Return" {% if order.status == 'Return' %}selected{% endif %}>‚Ü©Ô∏è Return</option>
                                    <option value="Cancel" {% if order.status == 'Cancel' %}selected{% endif %}>‚ùå Cancel</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-update shadow-sm">Update Status</button>
                        </form>
                        <div class="mt-4 pt-4 border-top text-center">
                            <p class="small text-muted mb-2">Need to contact customer?</p>
                            <a href="tel:{{ order.phone }}" class="btn btn-outline-dark rounded-pill w-100 fw-bold"><i class="fas fa-phone me-2"></i> Call Now</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}